<!DOCTYPE html>
<html>
    {% load static %}

<head>
    <title>Dashboard - AgricultureWala</title>
    <style>
        body {
            margin: 0;
            font-family: Arial;
            background-image: url("{% static 'images/dashboard.jpg' %}");
        background-size:cover;
        background-repeat: no-repeat;
        background-position: center;
        }

        @keyframes bgFlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        h2 {
            text-align: center;
            padding: 20px;
            color: #2d2d2d;
            background: #fff;
            margin: 0;
            box-shadow: 0px 5px 15px rgba(0,0,0,0.1);
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            padding: 30px;
        }

        .product {
            background: white;
            border-radius: 20px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .product:hover {
            transform: scale(1.05);
        }

        img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 10px;
        }

        h3 {
            margin: 10px 0 5px;
        }

        p {
            margin: 0 0 10px;
            color: green;
            font-weight: bold;
            font-size: 16px;
        }

        a.btn {
            display: inline-block;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: bold;
            transition: background 0.3s ease;
        }

        a.btn:hover {
            background: #218838;
        }
    </style>
</head>

<body>
    <div style="text-align: center; margin: 20px;">
        <form method="GET" action="">
            <input type="text" name="q" placeholder="Search for fruits or vegetables" value="{{ request.GET.q }}" style="padding: 10px; width: 300px; border-radius: 10px; border: 1px solid #ccc;">
            <button type="submit" style="padding: 10px 20px; background-color: green; color: white; border: none; border-radius: 10px;">Search</button>
        </form>
    </div>
    <h2>Welcome {{ request.user.username }} â€“ Fruits & Vegetables</h2>

    <div class="container">
        {% for product in products %}
        <div class="product">
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
            <h3>{{ product.name }}</h3>
            <p>â‚¹ {{ product.price }}</p>
            <a href="{% url 'add_to_cart' product.id %}" class="btn">Add to Cart</a>


        </div>
        {% endfor %}
    </div>
    <a href="{% url 'analytics' %}" style="
    display: inline-block;
    background-color: #007bff;
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    text-decoration: none;
    font-weight: bold;
    margin-bottom: 20px;
    float: right;
    transition: background 0.3s ease;
" onmouseover="this.style.background='#0056b3'" onmouseout="this.style.background='#007bff'">
    ðŸ“Š View Analytics
</a>
    
    </div>

    <!-- ðŸ’¬ Floating Chatbox -->
    <div id="chatbox" style="
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 300px;
        max-height: 400px;
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        overflow: hidden;
        display: none;
        flex-direction: column;
        font-family: Arial;
        animation: slideUp 0.5s ease-in-out;
        z-index: 9999;
    ">
        <div style="background-color: #28a745; color: white; padding: 12px; font-weight: bold;">
            Chat Support
            <span onclick="toggleChat()" style="float: right; cursor: pointer;">âœ–</span>
        </div>
        <div id="chat-messages" style="flex: 1; padding: 10px; overflow-y: auto; height: 200px;">
            <p><b>Bot:</b> Hello! How can I help you? ðŸ˜Š</p>
        </div>
        <div style="display: flex; border-top: 1px solid #ccc;">
            <input type="text" id="chat-input" placeholder="Type your message..." style="flex: 1; padding: 8px; border: none; outline: none;">
            <button onclick="sendMessage()" style="background-color: #28a745; color: white; border: none; padding: 8px 12px;">Send</button>
        </div>
    </div>

    <!-- ðŸ’¬ Chat Icon -->
    <div onclick="toggleChat()" style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #28a745;
        color: white;
        padding: 15px;
        border-radius: 50%;
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
        cursor: pointer;
        z-index: 9999;
        font-size: 22px;
        text-align: center;
    ">
        ðŸ’¬
    </div>

    <script>
        function toggleChat() {
            var chatbox = document.getElementById("chatbox");
            chatbox.style.display = chatbox.style.display === "flex" ? "none" : "flex";
        }

        function sendMessage() {
            var input = document.getElementById("chat-input");
            var message = input.value.trim().toLowerCase();
            if (message === "") return;

            var chatMessages = document.getElementById("chat-messages");
            chatMessages.innerHTML += "<p><b>You:</b> " + message + "</p>";

            let reply = "";

            if (message.includes("hello") || message.includes("hi")) {
                reply = "Hello! How can I assist you today?";
            } else if (message.includes("price") || message.includes("cost") || message.includes("rate")) {
                reply = "You can view all product prices directly on the product cards.";
            } else if (message.includes("apple price")) {
                reply = "Apples are â‚¹100 per kg. Want to add them to your cart?";
            } else if (message.includes("banana price")) {
                reply = "Bananas are â‚¹60 per dozen. Fresh and ripe!";
            } else if (message.includes("cart")) {
                reply = "Click on 'Add to Cart' to add any product. You can checkout from the Cart page.";
            } else if (message.includes("how to order") || message.includes("order")) {
                reply = "Just click 'Add to Cart' and proceed to generate the bill.";
            } else if (message.includes("bye")) {
                reply = "bye nice to talk youðŸŒ¿";
            } else {
                reply = "unable to answer. Try asking about product prices or help.";
            }

            setTimeout(() => {
                chatMessages.innerHTML += "<p><b>Bot:</b> " + reply + "</p>";
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 600);

            input.value = "";
        }
    </script>

</body>
</html>
